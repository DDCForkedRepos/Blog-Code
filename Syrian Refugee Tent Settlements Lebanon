##Informal Syrian Refugee Tents Location/Number
library(XLConnect)
library(zoo)
library(lubridate)
library(date)
library(ggmap)
library(ggplot2)
library(gdata)
##Get file from UNHCR Lebanon Data Portal
url<-"https://www.dropbox.com/sh/agy0qjqvo9121be/AAA6q3Aph4sbqfS_UVR9nPKna/2.%20Mapping%20and%20P-codes/List%20of%20Informal%20Settlements_2014_06_05.xlsx?dl=1"
download.file(url,destfile="List of Informal Settlements_2014_06_05.xlsx",mode="wb")
##Read .xlsx file
tents<-read.xlsx2("List of Informal Settlements_2014_06_05.xlsx",sheetName="IAMP3")
tents<-as.data.frame(tents)
##Steps to convert from Julian Date for date the tents settlement was created/documented 
tents$date<-as.numeric(as.character(tents$Date.the.site.was.created))
tents$date<-as.date(tents$date)
tents$date<-as.POSIXct(tents$date)-(60*365*24*60*60)
tents$date<-as.Date(tents$date)
tents$Longitude<-as.numeric(as.character(tents$Longitude))
tents$Latitude<-as.numeric(as.character(tents$Latitude))
tents$Number.of.Tents<-as.numeric(as.character(tents$Number.of.Tents))
tents$Number.of.Individuals<-as.numeric(as.character(tents$Number.of.Individuals))
##Parse NA values for non-Julian dates and convert to dates from date column
nas<-tents[(is.na(tents$date)),]
nas$date<-mdy(nas$Date.the.site.was.created)
nas<-subset(nas,!is.na(date))
tents<-subset(tents,!is.na(date))
tents<-rbind(tents,nas)
##All values in 'date' should be actual dates
tents$month<-as.yearmon(tents$date)
tents$year<-as.numeric(format(tents$date,"%Y")
tents$pplptent<-tents$Number.of.Individuals/tents$Number.of.Tents

##Create Map of Locations
bl<-get_map(location=c(35.8244200,33.8889400),source="google",
+             maptype="terrain",crop=FALSE)

##Map Refugees and Density of Tents in Lebanon

ggmap(bl)+overlay+geom_point(aes(Longitude,Latitude,color=tents$pplptent)
,size=2,data=tents)+scale_colour_gradient(expression(People_Per_Tent),low="red",high="black")
+ggtitle("Syrian Refugees in Lebanon")

##Just Zahle
ggmap(bl)+overlay+geom_point(aes(Longitude,Latitude,color=tents$pplptent)
,size=2,data=tents)+scale_colour_gradient(expression(People_Per_Tent),low="red",high="black")
+xlim(35.75,36)+ylim(33.6,33.9)+ggtitle("Syrian Refugees in Zahle, Lebanon")


##Plot Map of Refugees for different years in Zahle

ggmap(bl)+overlay+geom_point(aes(Longitude,Latitude,color=tents$pplptent),size=2,data=tents)
+scale_colour_gradient(expression(People_Per_Tent),low="red",high="black")
+xlim(35.75,36)+ylim(33.6,33.9)+ggtitle("Syrian Refugees in Zahle")+facet_wrap(~year)
